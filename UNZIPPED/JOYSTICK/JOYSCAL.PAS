program JoysCal;

uses
 dos,Crt;

var
 fim:boolean;
 fases, xok, yok, maxx, maxy, minx, miny, njoys:integer;
 ch: char;

procedure textxy(X, Y: integer; s:string);
begin
 gotoxy(x,y);
 write(s);
end;

function Strp(n:integer):string;
var
 s:string;
begin
 str(n,s);
  for n:=1 to 3-length(s) do s:=s+' ';
 strp:=s;
end;

function Stick(NCoor:integer):integer;
var
 regs : Registers;
begin                                               
 regs.ah := $84;
 regs.dx := 1;
 intr($15, regs);
 case NCoor of
  0:  Stick:=regs.ax;  { Coor X do Joystick 1 }
  1:  Stick:=regs.bx;  { Coor Y do Joystick 1 }
  2:  Stick:=regs.cx;  { Coor X do Joystick 2 }
  3:  Stick:=regs.dx;  { Coor Y do Joystick 2 }
  else Stick:=0;
  end
end;

Procedure fase(fases:integer);
begin
 Case fases of
  1:
  begin
   {inicio}
   textxy(36,8,' Benvindo ao Joyscal para DOS ');
   textxy(36,9,'                              ');
   textxy(36,10,'  Este utilit rio tem como    ');
   textxy(36,11,' fun‡„o ajudar o utilizador   ');
   textxy(36,12,' PC a calibrar o seu Joystick.');
   textxy(36,13,'  Espero que vos venha a ser  ');
   textxy(36,14,' util.                        ');
   textxy(36,15,'             Pedro Sinogas    ');
   textxy(36,16,'                     Nov/93   ');

  end;
  2:
  begin
   {getmin}
   textxy(36,8,' Como calibrar o seu Joystick ');
   textxy(36,9,'                     1¦ fase  ');
   textxy(36,10,'                              ');
   textxy(36,11,'  Rode os controlos X-AXIS e  ');
   textxy(36,12,' Y-AXIS no sentido MIN, at‚   ');
   textxy(36,13,' n„o dar mais e posicione o   ');
   textxy(36,14,' Joystick no canto SUPERIOR   ');
   textxy(36,15,' ESQUERDO.                    ');
   textxy(36,16,'                  <C>ontinuar ');
  end;
  3:
  begin
   {getmax}
   maxx := stick(0 + njoys * 2);
   maxy := stick(1 + njoys * 2);
   textxy(36,8,' Como calibrar o seu Joystick ');
   textxy(36,9,'                     2¦ fase  ');
   textxy(36,10,'                              ');
   textxy(36,11,'  Rode os controlos X-AXIS e  ');
   textxy(36,12,' Y-AXIS no sentido MAX, at‚   ');
   textxy(36,13,' n„o dar mais e posicione o   ');
   textxy(36,14,' Joystick no canto INFERIOR   ');
   textxy(36,15,' DIREITO.                     ');
   textxy(36,16,'                  <C>ontinuar ');
  end;
  4:
  begin
   {setok}
   minx := stick(0 + njoys * 2);
   miny := stick(1 + njoys * 2);
   xok := (maxx + minx) div 2;
   yok := (maxy + miny) div 2;
   textxy(36,8,' Como calibrar o seu Joystick ');
   textxy(36,9,'                     3¦ fase  ');
   textxy(36,10,'                              ');
   textxy(36,11,'  Por fim, centre o Joystick  ');
   textxy(36,12,' e rode os controlos X-AXIS   ');
   textxy(36,13,' e Y-AXIS, at‚ obter, o valor ');
   textxy(36,14,' '+Strp(Round(xok))+' para X e '+Strp(Round(yok))+' para Y.     ');
   textxy(36,15,'                              ');
   textxy(36,16,'                  <C>ontinuar ');
  end;
  5:
  begin
   textxy(36,8,' Para quaisquer coment rios   ');
   textxy(36,9,' ou d£vidas contactar o autor:');
   textxy(36,10,'                              ');
   textxy(36,11,'         Pedro Sinogas        ');
   textxy(36,12,'         Rua A - Lote 6A      ');
   textxy(36,13,'         Madorna              ');
   textxy(36,14,'         2775 Parede          ');
   textxy(36,15,'                              ');
   textxy(36,16,'                Novembro 93   ');
  end;
 End;
End;




procedure EC(X,Y,C:integer);
var
 coor:string[3];
 a:integer;
begin
  gotoxy(x,y);
  str(stick(c),coor);
  for a:=1 to 3-length(coor) do coor:=coor+' ';
  write(coor);
end;

procedure inicializa;
const
  IMAGEDATA : array [1..2000] of Char = (
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','J','J','J','J','J','J',
    ' ',' ',' ','O','O','O','O',' ',' ',' ','Y','Y',' ',' ',' ',' ','Y',
    'Y',' ',' ',' ','S','S','S','S','S',' ',' ',' ',' ','C','C','C','C',
    'C',' ',' ',' ','A','A','A','A',' ',' ',' ','L','L',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','J','J',' ',' ','O','O',' ',
    ' ','O','O',' ',' ',' ','Y','Y',' ',' ','Y','Y',' ',' ',' ','S','S',
    ' ',' ',' ',' ',' ',' ',' ','C','C',' ',' ',' ',' ',' ',' ','A','A',
    ' ',' ','A','A',' ',' ','L','L',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ','J','J',' ',' ','O','O',' ',' ','O','O',' ',' ',
    ' ',' ','Y','Y','Y','Y',' ',' ',' ',' ',' ','S','S','S','S','S',' ',
    ' ',' ','C','C',' ',' ',' ',' ',' ',' ','A','A','A','A','A','A',' ',
    ' ','L','L',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','J','J',' ',' ',
    'J','J',' ',' ','O','O',' ',' ','O','O',' ',' ',' ',' ',' ','Y','Y',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','S','S',' ',' ','C','C',' ',
    ' ',' ',' ',' ',' ','A','A',' ',' ','A','A',' ',' ','L','L',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ','J','J','J','J',' ',' ',' ',' ',
    'O','O','O','O',' ',' ',' ',' ',' ',' ','Y','Y',' ',' ',' ',' ',' ',
    ' ','S','S','S','S','S',' ',' ',' ',' ','C','C','C','C','C',' ',' ',
    'A','A',' ',' ','A','A',' ',' ','L','L','L','L','L','L',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ','P','a','r','a',' ','D','O','S',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ','É','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','»',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','³',' ','³',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ','É','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','»','É','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','Í','Á','Í','Á','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','»',' ',' ','º',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ','º',' ','º','<','C','>','o','n','t',
    'i','n','u','a','r','º','º',' ','Ú','Ä','¿',' ',' ',' ',' ',' ','X',
    '-','A','x','i','s',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','Ú',
    'Ä','¿',' ','º',' ',' ','º',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ','º',' ','È','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    '¼','º',' ','À','Ä','Ù',' ',' ',' ','Ú','Ä','Â','Ä','Â','Ä','Â','Ä',
    '¿',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','À','Ä','Ù',' ','º',' ',
    ' ','º',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ',
    'É','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','»','º',' ',' ',' ',
    ' ',' ',' ',' ','À','Ä','Á','Ä','Á','Ä','Á','Ä','Ù',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ',' ','º',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ','º',' ','<','R','>',
    'e','c','u','a','r',' ',' ','º','º',' ','Ú','Ä','¿',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','Ú','Ä','¿',' ',' ',' ',
    ' ',' ',' ',' ',' ','º',' ',' ','º',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ','º',' ','È','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','¼','º',' ','Ã','Ä','´',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ','Ã','Ä','´',' ',' ',' ',' ',' ',' ',' ',' ',
    'º',' ',' ','º',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    'º',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ',
    'Ã','Ä','´','Y','.','F','r','e','e',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ','Ã','Ä','´',' ','X','.','F','r','e','e',' ','º',' ',' ','º',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ','É','Í','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','Í','»','º',' ','Ã','Ä','´',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','Ã','Ä','´',' ',
    ' ',' ',' ',' ',' ',' ',' ','º',' ',' ','º',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ','º',' ','º',' ',' ','<','S','>','a','i',
    'r',' ',' ',' ','º','º',' ','À','Ä','Ù',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ','À','Ä','Ù',' ',' ',' ',' ',' ',' ',
    ' ',' ','º',' ',' ','È','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','¼',' ','È','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','¼',
    'º',' ',' ',' ',' ',' ',' ',' ',' ',' ','Y','-','A','x','i','s',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ','É','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','Í','Ë','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','»',' ',' ',' ',' ',' ',' ','º',' ','Ú','Ä','¿',
    ' ',' ',' ','Ú','Ä','Â','Ä','Â','Ä','Â','Ä','¿',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ','Ú','Ä','¿',' ','º',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ','º',' ',' ','J','o','y','s','t','i','c','k',' ',' ','1',' ',
    ' ','º',' ',' ','J','o','y','s','t','i','c','k',' ',' ','2',' ',' ',
    'º',' ',' ',' ',' ',' ',' ','º',' ','À','Ä','Ù',' ',' ',' ','À','Ä',
    'Á','Ä','Á','Ä','Á','Ä','Ù',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    'À','Ä','Ù',' ','º',' ',' ',' ',' ',' ',' ',' ',' ',' ','Ç','Ä','Ä',
    'Ä','Ä','Ä','Ä','Ä','Â','Ä','Ä','Ä','Ä','Ä','Ä','Ä','º','Ä','Ä','Ä',
    'Ä','Ä','Ä','Ä','Â','Ä','Ä','Ä','Ä','Ä','Ä','Ä','¶',' ',' ',' ',' ',
    ' ',' ','È','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í',
    'Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','Í','¼',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ','º',' ','X',' ',' ',' ',' ',' ',
    '³',' ','Y',' ',' ',' ',' ',' ','º',' ','X',' ',' ',' ',' ',' ','³',
    ' ','Y',' ',' ',' ',' ',' ','º',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ','È','Í','Í','Í','Í','Í','Í','Í','Ï','Í','Í','Í','Í',
    'Í','Í','Í','Ê','Í','Í','Í','Í','Í','Í','Í','Ï','Í','Í','Í','Í','Í',
    'Í','Í','¼',' ',' ',' ',' ',' ',' ','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä',
    'Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä',
    'Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä',
    'Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä',
    'Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä','Ä',
    'Ä','Ä','Ä','Ä',' ',' ','E','s','t','e',' ','p','r','o','g','r','a',
    'm','a',' ','‚',' ','p','a','r','t','e',' ','i','n','t','e','g','r',
    'a','n','t','e',' ','d','o',' ','a','r','t','i','g','o',' ','J','O',
    'Y','S','T','I','C','K',' ','d','a',' ','R','e','v','i','s','t','a',
    ' ','S','p','o','o','l','e','r',' ','p','o','r',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
    ' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','P','e','d','r',
    'o',' ','S','i','n','o','g','a','s',' ',' ');

var
 a:integer;
 ch:char;
begin

 While (a <> 1) And (a <> 2) do
 begin
  Writeln('Insira o n£mero do Joystick que pertende calibrar [1/2]');
  repeat until keypressed;
  ch:=readkey;
  Val(ch,a,a);
 end;
  njoys := a - 1;

 fim:=false;
 asm
   mov  ah,0                        
   mov  al,2                        
   int  10h                         
   mov  ah,1
   mov  ch,00100000b
   mov  cl,0
   int  10h
 end;
 textcolor(yellow);
 textbackground(blue);
 clrscr;
 gotoxy(1,1);
 for a:=1 to 1999 do
 begin
  write(imagedata[a]);
 end;

  fases := 1;
  fase(fases);

end;

procedure finaliza;
begin
 clrscr;
 gotoxy(1,2);
 writeln('Obrigado por utilizar o JOYSCAL para Dos',#13,#10);
 writeln('Para quaisquer coment rios ou d£vidas contactar o autor:',#13,#10);
 writeln('      Pedro Sinogas',#13,#10,'      Rua A - Lote 6A',#13,#10,'      Madorna');
 writeln('      2775 Parede',#13,#10,#13,#10,'          Novembro 93',#13,#10,#13,#10);
 asm
   mov  ah,1
   mov  ch,00011111b
   mov  cl,00001110b
   int  10h
 end;
end;

function Tecla:char;
begin
 repeat
  ec(46,21,0);           {Joystick 1, X}
  ec(54,21,1);           {Joystick 1, Y}
  ec(62,21,2);           {Joystick 2, X}
  ec(70,21,3);           {Joystick 2, Y}
 until keypressed; Tecla:=readkey;
end;

procedure Beep;
begin
 Sound(220);
 Delay(200);
 NoSound;
end;

Procedure Continuar;
Begin
 If fases < 5 Then inc(fases) Else beep;
 fase(fases);
End;

Procedure Recuar;
Begin
 If fases > 1 Then dec(fases) else beep;
 fase (fases);
End;

begin

 inicializa;

 repeat
  ch:=tecla;
  case upcase(ch) of
   'C': continuar;
   'R': recuar;
   'S': fim:=true;
   #27: fim:=true;
  end;
 until fim;

 finaliza;
end.